# 八比特风水师 UI 视觉总方案 v2.0（唯一执行标准）

## 0. 文档定位

本方案是项目 UI 视觉与交互的唯一标准稿，用于替代和收敛既有分散规范。  
本方案不提供备选路线，不讨论成本折中，只追求最终观感最优解。

目标关键词：
- 质感
- 高级感
- 氛围感
- 美感
- 简约克制

设计哲学：
- 少即是多，克制优于堆砌。
- 模型房间图是主角，UI 只做秩序与情绪引导。
- 统一胜过炫技，稳定胜过惊艳一瞬。

---

## 1. 全局唯一视觉语言

## 1.1 品牌气质定义

视觉气质：静、暖、净、稳。  
观感方向：高端东方像素氛围，不走炫色卡牌，不走赛博霓虹，不走手游大特效。

核心规则：
- 全局只允许一个强调色系：暖金系。
- 全局主背景保持低饱和冷深色。
- 动效以"缓入缓出、低频、低幅度"为基调。
- 形体尽量锐利：小圆角或无圆角。

## 1.2 色彩系统（唯一）

### 基础色

- `--feng-bg-0`: `#0E1116`（最深背景）
- `--feng-bg-1`: `#151A22`（主面板）
- `--feng-bg-2`: `#202736`（次面板）
- `--feng-bg-3`: `#2A3243`（高层容器）

### 文字色

- `--feng-text-0`: `#F5E4BB`（主标题亮金）
- `--feng-text-1`: `#E2E8F0`（主正文）
- `--feng-text-2`: `#AAB3C2`（次正文）
- `--feng-text-3`: `#7B8490`（弱提示）

### 强调色（仅一套）

- `--feng-accent-0`: `#C4A06A`（主强调）
- `--feng-accent-1`: `#D4B07A`（高亮）
- `--feng-accent-2`: `#8B6914`（深压）

### 语义状态色（极克制）

- `--feng-success`: `#8FAE7B`（仅用于"已净化"）
- `--feng-error`: `#A6685B`（仅用于"错误反馈"）

严格禁止：
- 关卡级多色主题漂移。
- 紫色、荧光色、彩虹色作为 UI 主导。
- 同屏超过 1 个高饱和焦点色。

## 1.3 字体系统（唯一）

字体策略：
- 中文标题与按钮：`font-pixel`（Press Start 2P）优先。
- 中文正文与说明：统一像素风字体，不混入现代 UI 字体。
- 英文仅用于辅助标签，不抢主中文叙事。

推荐字号层级：
- Hero 标题：20px
- 页面标题：16px
- 区块标题：12px
- 正文：11px
- 说明：8-9px
- 脚注：7px

统一排版参数：
- 标题字距：`0.08em`
- 正文字距：`0.04em`
- 正文行高：`2.0` 到 `2.3`

## 1.4 形体与空间

圆角体系：
- 卡片：2px
- 按钮：2px
- 浮层：2px

间距体系（像素网格）：
- 单位：4px
- 常用间距：8 / 12 / 16 / 24 / 32 / 40
- 主内容块最小内边距：40px

边框体系：
- 外层：1px `rgba(196,160,106,0.30)`
- 内层：2px `rgba(196,160,106,0.40)`

---

## 2. 层级与材质系统

## 2.1 五层结构（固定）

1. 房间背景层（冷图或暖图）
2. 遮罩层（聚焦中心）
3. 玻璃容器层（信息承载）
4. 像素边框层（品牌识别）
5. 文本与交互层（操作）

## 2.2 玻璃材质参数（固定）

玻璃背景：
- `linear-gradient(135deg, rgba(30,35,45,0.35) 0%, rgba(21,26,34,0.40) 100%)`

模糊：
- `blur(22px) saturate(1.35)`

边框：
- `2px solid rgba(196,160,106,0.45)`

阴影三层：
- `inset 0 1px 1px rgba(255,255,255,0.09)`
- `inset 0 0 48px rgba(196,160,106,0.03)`
- `0 10px 36px rgba(0,0,0,0.36), 0 0 88px rgba(196,160,106,0.06)`

约束：
- 玻璃透明度不得低于可读阈值，不得出现"轻飘发灰"。
- 同屏玻璃层最多 2 层，避免材质噪音。

---

## 3. 动效系统（高级感最小化原则）

## 3.1 动效总原则

- 动效数量少于动效复杂度。
- 一次交互只突出一个动效重点。
- 时间曲线以 `ease-out` 与 `cubic-bezier(0.22, 1, 0.36, 1)` 为主。
- 禁止高频抖动、快闪、夸张弹跳。

## 3.2 全局动效节奏

- 页面入场：400-500ms
- 面板滑入：260-320ms
- 轻提示淡入：180-220ms
- 状态切换：300-600ms
- 通关转场：700ms（冷暖图渐变）

---

## 4. 页面级统一改造规范

## 4.1 Splash（Feed 入口）

定位：
- 只承担转化，不承载玩法细节。

结构：
- 背景房间图
- 中央玻璃卡片
- 单 CTA

限制：
- 不出现复杂步骤图。
- 不出现多按钮竞争。

## 4.2 GameStart（启动页）

定位：
- 建立氛围，强化"净化房间"的使命感。

结构：
- 标题区
- 一句玩法主语义
- 单主按钮
- 弱提示一行

限制：
- 视觉中心只能有一个按钮焦点。
- 辅助装饰不超过 2 类。

## 4.3 LevelSelect（选关页）

定位：
- 展示进度，不展示色彩秀场。

唯一方案：
- 全关卡卡片统一暖金体系。
- 不再按关卡切换主色。
- 锁定态通过明度和清晰度区分，不用换色相区分。

卡片信息优先级：
1. 关卡编号与名称
2. 难度与煞气数量
3. 简述
4. 时长

## 4.4 Gameplay（核心玩法页）

定位：
- 房间图绝对主角，UI 退后一步。

结构固定：
- 顶部细状态栏（低干扰）
- 中部全屏房间与罗盘
- 底部单行引导提示（非弹窗时）
- 事件弹窗层

顶栏视觉策略：
- 半透明、低对比、窄高度
- 仅保留必要信息：关卡名、净化进度、返回

## 4.5 EventModal（事件弹窗）

定位：
- 信息清晰，决策快速，不喧宾夺主。

移动端：
- 底部浮起面板，圆角 2px，玻璃材质统一。

桌面端：
- 右侧窄面板，宽度固定，层级清晰。

选项样式：
- 默认低饱和中性底
- 选中仅提升边框与微弱暖金辉光
- 禁止大面积高亮块面

---

## 5. 核心新增体验：通关转暖仪式（唯一方案）

## 5.1 目标

当前问题是"仅弹出通关提示"，情绪峰值不足。  
本方案将通关设计为一个简洁的"净化仪式"，配合通关弹窗展示。

## 5.2 触发条件

当关卡内所有煞气点都被正确处置后立即触发：
- `resolvedCount === shaCount`

## 5.3 通关流程（两阶段）

### Phase A：渐变转暖（与弹窗同步）

触发时机：最后一个煞气正确处置后

表现：
- 通关祝贺弹窗弹出（现有组件）
- **同时**冷图与暖图开始交叉渐变：
  - 冷图 alpha: 1 -> 0
  - 暖图 alpha: 0 -> 1
  - 时长 700ms，曲线 `ease-out`
- 细小暖尘粒子向上缓慢漂移（数量少，速度慢）
- 渐变动画独立执行，不受弹窗关闭影响

目的：
- 让玩家在看到通关弹窗的同时，感知房间从冷到暖的转变。

### Phase B：通关后常驻

弹窗关闭后：
- 罗盘淡出消失
- 底部提示文案切换为"按住查看净化前"
- 进入暖图常驻状态，可对比交互

## 5.4 通关后界面状态（固定）

通关后只保留：
- 暖色房间图（默认显示）
- 极简顶部状态（显示"已净化"）
- 底部提示：`按住查看净化前`
- 操作按钮：`重玩` / `继续探索`

移除元素：
- 罗盘（淡出隐藏）
- 扫描提示文案
- 煞气事件触发逻辑

## 5.5 关卡通关记忆（新增）

**首次通关**：
- 完成关卡后保存通关状态到本地存储

**再次进入已通关关卡**：
- 直接显示暖色图
- 罗盘隐藏
- 底部显示"按住查看净化前"提示
- 提供"重玩"按钮，可重新挑战（重置为冷图 + 罗盘探测模式）

**重玩逻辑**：
- 点击"重玩"按钮后，仅清除当前关卡的通关记录
- 重新进入 `scanning` 状态，显示冷图 + 罗盘探测模式
- **已解锁的后续关卡不受影响**：解锁状态由独立的 `unlocked_levels` 管理
- 重玩通关后再次保存通关记录

**存储方案**：
- 使用 `localStorage` 存储已通关关卡 ID 列表
- key 常量定义：
  - `FENGSHUI_COMPLETED_LEVELS_KEY = 'fengshui_completed_levels'`
  - `FENGSHUI_UNLOCKED_LEVELS_KEY = 'fengshui_unlocked_levels'`
- value: `["level-1", "level-2", ...]`

---

## 6. 冷暖对比交互（按住查看）

## 6.1 交互定义

目标：
- 让玩家直接感知改造前后差异，强化满足感与分享欲。

规则：
- 默认显示暖图（通关态常驻）。
- 按住屏幕或鼠标左键按住时，临时显示冷图。
- 松开后立即回到暖图。
- 不切换任何其他 UI 状态。

## 6.2 交互映射

移动端：
- `pointerdown` 开始显示冷图
- `pointerup` / `pointercancel` 恢复暖图

桌面端：
- `mousedown` 开始显示冷图
- `mouseup` / `mouseleave` 恢复暖图

键盘辅助（桌面）：
- 按住 `Space` 显示冷图
- 释放 `Space` 恢复暖图
- **必须** `preventDefault()` 阻止页面滚动

## 6.3 动效参数

冷暖切换不做夸张动画，保持即时可比：
- `120ms` 线性淡切
- 禁止超过 `180ms`

## 6.4 文案与提示

通关后底部提示统一为：
- 主提示：`按住查看净化前`
- 次提示：`松开返回净化后`

文案语气：
- 中性克制，不口号化。

---

## 7. 交互状态机（含新增状态）

## 7.1 状态定义

| 状态 | 说明 |
|-----|------|
| `scanning` | 罗盘探测中，寻找煞气点 |
| `event_modal` | 煞气事件弹窗显示中 |
| `resolving` | 煞气正在被化解（选择正确选项后） |
| `transitioning` | 通关渐变转暖中（与弹窗同步） |
| `completed` | 通关完成，暖图常驻 |
| `comparing` | 按住查看冷图中 |

## 7.2 状态迁移

```
scanning -> event_modal      : 罗盘探测到煞气点
event_modal -> scanning      : 选择错误，继续探测
event_modal -> resolving     : 选择正确选项
resolving -> scanning        : 还有未净化的煞气
resolving -> transitioning   : 最后一个煞气被净化
transitioning -> completed   : 弹窗关闭，转暖完成
completed -> comparing       : 按住触发
comparing -> completed       : 释放触发
```

## 7.3 状态约束

- `transitioning` 期间禁用所有交互输入。
- `completed` 与 `comparing` 状态不再触发煞气探测逻辑。
- 关卡重玩时重置为 `scanning` 状态。

## 7.4 异常边界处理

**转场中断**：
- `transitioning` 期间检测到 `visibilitychange`（切 tab/最小化），强制完成转暖并进入 `completed` 状态，防止卡死

**对比状态失焦**：
- `comparing` 状态下检测到 `blur` / `visibilitychange`，自动恢复暖图并回到 `completed` 状态

**多指触控**：
- 以首指状态为准，使用 `changedTouches[0]` 识别
- `touchcancel` 事件触发时立即恢复暖图

**失焦处理**：
- 监听 `visibilitychange` 和 `blur` 事件
- 任何状态下失焦都应确保回到安全的 UI 状态

---

## 8. 视觉与实现映射（前端落地指引）

本节用于把设计语言直接映射到现有 React + Pixi 架构。

## 8.1 主题令牌统一

文件：
- `src/frontend/feng-shui-8-bit/src/client/index.css`

要求：
- 收敛为本方案给定唯一 token。
- 移除关卡色相漂移依赖。
- 保留暖金单强调逻辑。

## 8.2 页面收敛范围

文件：
- `src/frontend/feng-shui-8-bit/src/client/pages/SplashPage.tsx`
- `src/frontend/feng-shui-8-bit/src/client/pages/GameStartPage.tsx`
- `src/frontend/feng-shui-8-bit/src/client/pages/LevelSelectPage.tsx`
- `src/frontend/feng-shui-8-bit/src/client/pages/GameplayPage.tsx`
- `src/frontend/feng-shui-8-bit/src/client/components/game/EventModal.tsx`

改造要求：
- 全页面统一材质参数。
- 全页面统一字体策略。
- 全页面统一圆角和边框层级。

## 8.3 通关转暖逻辑落点

文件：
- `src/frontend/feng-shui-8-bit/src/client/stores/GameContext.tsx`（状态管理）
- `src/frontend/feng-shui-8-bit/src/client/game/GameStage.tsx`（冷暖图渐变）
- `src/frontend/feng-shui-8-bit/src/client/pages/GameplayPage.tsx`（通关弹窗 + 按住交互）
- `src/frontend/feng-shui-8-bit/src/client/hooks/useProgress.ts`（通关记忆）

必要新增状态（GameContext）：
- `gameState`: `'scanning' | 'event_modal' | 'resolving' | 'transitioning' | 'completed' | 'comparing'`
- `isComparingCold`: `boolean`（按住查看冷图）
- `isPreviouslyCompleted`: `boolean`（之前已通关，直接进暖图）

新增 Hook：
- `useLevelCompletion(levelId: string)`: 返回 `{ isCompleted, markCompleted }`

时序执行：
1. 最后一个煞气正确处置后，设置 `gameState = 'transitioning'`
2. 触发冷暖图渐变动画（700ms）
3. 显示通关弹窗
4. 弹窗关闭后，设置 `gameState = 'completed'`
5. 罗盘淡出隐藏
6. 开启按住对比输入监听
7. 保存通关状态到 localStorage

## 8.4 输入与冲突处理

优先级：
1. 通关转场锁输入
2. 对比输入高于普通 UI hover
3. 对比输入不触发任何 modal

异常处理：
- 失焦自动回暖图，防止停留冷图
- 多指触控时以首指状态为准

事件监听实现：
```typescript
// 失焦处理
document.addEventListener('visibilitychange', () => {
  if (document.hidden) {
    // transitioning: 强制完成转暖
    // comparing: 恢复暖图
  }
});

// 键盘 Space 键
window.addEventListener('keydown', (e) => {
  if (e.code === 'Space') {
    e.preventDefault(); // 阻止页面滚动
    // 显示冷图
  }
});

// 多指触控
element.addEventListener('touchstart', (e) => {
  const touch = e.changedTouches[0]; // 首指
  // 处理逻辑
});
```

---

## 9. 声画反馈（极简高级版）

音效策略：
- 通关只用 1 个"净化完成"短音，不叠加连续奖章音。
- 按住对比不播放音效，保持静谧。

粒子策略：
- 粒子总量低，透明度低，速度低。
- 只在通关转场期间出现，向上漂移。
- 不常驻漂浮。

---

## 10. 质量门槛（必须全部满足）

## 10.1 视觉验收

- [ ] 全站仅一套主强调色（暖金），无关卡色相漂移。
- [ ] 所有主容器玻璃参数一致，无"薄灰漂"感。
- [ ] 视觉焦点始终唯一，不出现多焦点竞争。
- [ ] 文本字号层级稳定，无突兀断档。

## 10.2 交互验收

- [ ] 最后一个煞气净化后触发冷暖图渐变（与弹窗同步）。
- [ ] 弹窗关闭后罗盘淡出消失。
- [ ] 按住显示冷图、松开回暖图 100% 稳定。
- [ ] 通关对比状态不再触发任何煞气事件。
- [ ] 再次进入已通关关卡直接显示暖图。
- [ ] 重玩按钮可重置为冷图 + 罗盘探测模式。

## 10.3 性能验收

- [ ] 转暖动画期间无明显掉帧或卡顿。
- [ ] 连续按住/松开对比无闪烁和残影。
- [ ] Mobile 与 Desktop 表现一致。

---

## 11. 版本与生效声明

生效日期：
- `2026-02-23`

生效范围：
- `src/frontend/feng-shui-8-bit/src/client/*`

优先级：
- 本方案高于历史 UI 草案与分散口头约定。

执行原则：
- 后续所有 UI 变更必须先对照本方案，不允许再次出现风格分叉。